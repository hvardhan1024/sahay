<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50">
  <%- include('../../partials/navbar') %>
  
  <div class="flex">
    <%- include('../../partials/sidebar') %>
    
    <!-- Main Content -->
    <div class="flex-1 p-8">
      <!-- Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Student Profile</h1>
        <p class="text-gray-600">Manage your personal information and preferences.</p>
      </div>

      <!-- Messages -->
      <% if (typeof success !== 'undefined' && success) { %>
        <div class="mb-6 p-4 bg-green-50 border-l-4 border-green-400 rounded-lg">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="ml-3">
              <p class="text-sm text-green-700"><%= success %></p>
            </div>
          </div>
        </div>
      <% } %>

      <% if (typeof error !== 'undefined' && error) { %>
        <div class="mb-6 p-4 bg-red-50 border-l-4 border-red-400 rounded-lg">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="ml-3">
              <p class="text-sm text-red-700"><%= error %></p>
            </div>
          </div>
        </div>
      <% } %>

      <!-- Profile Form -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
        <form method="POST" action="/student/profile" class="space-y-6">
          <!-- Personal Information -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Personal Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                  Full Name
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  value="<%= user.name %>"
                  required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                >
              </div>

              <div>
                <label for="age" class="block text-sm font-medium text-gray-700 mb-2">
                  Age
                </label>
                <input
                  type="number"
                  id="age"
                  name="age"
                  value="<%= user.age || '' %>"
                  min="13"
                  max="100"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                >
              </div>
            </div>
          </div>

          <!-- Academic Information -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Academic Information</h3>
            <div>
              <label for="institution" class="block text-sm font-medium text-gray-700 mb-2">
                Institution/School
              </label>
              <input
                type="text"
                id="institution"
                name="institution"
                value="<%= user.institution || '' %>"
                placeholder="Your school or university"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
              >
            </div>
          </div>

          <!-- Bio -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">About You</h3>
            <div>
              <label for="bio" class="block text-sm font-medium text-gray-700 mb-2">
                Bio (Optional)
              </label>
              <textarea
                id="bio"
                name="bio"
                rows="4"
                maxlength="500"
                placeholder="Tell us a bit about yourself, your interests, or what you're studying..."
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
              ><%= user.bio || '' %></textarea>
              <p class="text-sm text-gray-500 mt-1">
                <span id="bio-count"><%= (user.bio || '').length %></span>/500 characters
              </p>
            </div>
          </div>

          <!-- Account Information (Read-only) -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Account Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Email Address
                </label>
                <div class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-600">
                  <%= user.email %>
                </div>
                <p class="text-xs text-gray-500 mt-1">Email cannot be changed</p>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Member Since
                </label>
                <div class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-600">
                  <%= new Date(user.joinedAt).toLocaleDateString() %>
                </div>
              </div>
            </div>
          </div>

          <!-- Save Button -->
          <div class="flex justify-end space-x-4">
            <button
              type="button"
              onclick="window.location.href='/dashboard'"
              class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium"
            >
              Save Changes
            </button>
          </div>
        </form>
      </div>

      <!-- Privacy Notice -->
      <div class="mt-8 bg-blue-50 border border-blue-200 rounded-xl p-6">
        <div class="flex items-start space-x-3">
          <div class="flex-shrink-0">
            <svg class="w-5 h-5 text-blue-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m0 0v2m0-2h2m-2 0H9m3-7V6a3 3 0 013 3v0a3 3 0 01-3 3v0z"></path>
            </svg>
          </div>
          <div>
            <h4 class="font-semibold text-blue-800 mb-2">Privacy & Security</h4>
            <p class="text-sm text-blue-700">
              Your personal information is kept private and secure. Only you can see your full profile details. 
              Other users in group chats will only see your name and can interact with you in public chat spaces.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Bio character counter
    const bioTextarea = document.getElementById('bio');
    const bioCount = document.getElementById('bio-count');

    bioTextarea.addEventListener('input', function() {
      bioCount.textContent = this.value.length;
    });
  </script>
</body>
</html>